# AtomicHabits

:calendar: В 2018 году Джеймс Клир написал книгу «Атомные привычки», которая посвящена приобретению новых полезных привычек и искоренению старых плохих привычек. Данное приложение предназначено для создания напоминаний о нужных привычках и их отправке пользователю через telegram.
Приложение реализует механизм CRUD для сущности "Привычка", позволяет регистрировать пользователей и отправлять напоминания в telegram.
---------------------------------------------

Сервис использует PostgreSQL в качестве основной базы данных для проекта, **Celery** для выполнения различных периодических задач (таких как отслеживание напоминаний, требующих отправки), 
а также **Redis** -  NoSQL базу данных для обеспечения работы Celery с периодическими задачами.

## Инструкция для запуска вручную (через консоль): ⌨️

:clipboard: Для использования приложения следует выполнить ряд инструкций:
1. Клонировать проект
2. Проверить наличие и установить при необходимости программы **PostgreSQL**, **Celery** и **Redis**
3. Установить и активировать виртуальное окружение для проекта
4. Установить зависимости из файла *requirements.txt* или *pyproject.toml*
5. Создать базу данных в **postgres** и внести требуемые настройки в файл *.env* (пример оформления и наполнения такого файла находится в корне проекта и называется *.env.sample*)
6. Создать своего телеграм-бота (для этого нужно перейти по [ссылке](https://t.me/BotFather)) или использовать уже имеющегося
7. Записать токен своего бота в файл *.env*
8. Провести миграции `python manage.py migrate`
9. Создать суперюзера для возможности администрирования при помощи команды `python manage.py create_superuser`
10. Запустить сервер `python manage.py runserver`
11. Запустить главную функцию в файле *telegram-bot/telegram_bot.py*
12. Запустить в консоли обработчика задач (worker) и планировщика задач:
    + `celery -A config worker --loglevel=info`
    + `celery -A config beat --loglevel=info`

Для того, чтобы пользователь смог получать уведомления в telegram, он должен начать диалог с созданным ботом через команду /start в соответствующем чате. 
После этого он может создавать привычки с требуемой периодичностью напоминания и получать уведомления, когда придет время выполнить действие. 

:clock2:

## Инструкции для запуска через Docker :whale2:

### Настройки окружения
Для успешного запуска проекта необходимо предоставить файл `.env.docker`, который содержит настройки, описанные в файле .env.docker.sample (файл-образец).
Перед началом работы следует заполнить значения для описанных переменных согласно потребностям и требованиям проекта.

### Структура проекта
Структура проекта включает в себя следующие ключевые файлы и каталоги:

- `.env.docker.sample`: Образец файла `.env.docker` с переменными окружения. Необходимо создать отдельный файл `.env.docker` на основе этого образца и заполнить значения.

- `Dockerfile`: Файл Dockerfile для сборки контейнера приложения.

- `docker-compose.yaml`: Файл конфигурации Docker Compose, который определяет контейнеры и их зависимости.
  
- `requirements.txt`: Файл, содержащий информацию о зависимостях, которые должны быть установлены при запуске контейнера.

### Docker-контейнеры
Проект использует Docker для контейнизации приложения и его зависимостей. Всего есть пять контейнеров:

1. `redis`: Контейнер с Redis, который используется в качестве брокера для Celery.

2. `postgres_db`: Контейнер с PostgreSQL для хранения данных приложения. Параметры PostgreSQL определены в файле `.env.docker`.

3. `app`: Контейнер для приложения Django. Запускает миграции, создает суперпользователя и собирает статикув отдельную папку.
   
4. `telegram-bot`: Контейнер для запуска телеграм-бота. Бот будет собирать информацию об id зарегистрированных пользователей и добавлять эти id в базу данных. 

5. `celery`: Контейнер для выполнения задач в фоновом режиме с использованием Celery. Зависит от контейнеров `redis` и `courses`.

6. `celery-beat`: Контейнер для выполнения периодических задач с использованием Celery Beat. Зависит от контейнеров `redis` и `courses`.
   
7. `web`: Контейнер для запуска gunicorn.

### Запуск проекта
Чтобы запустить проект через Docker требуется:
1. Клонировать этот репозиторий.
   
2. Скопировать переменные из `.env.docker.sample` в `.env.docker` и установить необходимые значения переменных окружения, как описано в разделе "Настройки окружения".

3. Убедиться, что установлены Docker и Docker Compose.

4. В командной строке выполнить команду:
`docker-compose up --build`


:shipit:
